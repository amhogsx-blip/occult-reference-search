<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Occult Reference Net</title>

<!-- Favicon (prevents /favicon.ico 404) -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' fill='black'/%3E%3Ccircle cx='32' cy='36' r='16' fill='%23ff69b4'/%3E%3C/svg%3E">

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
<style>
  :root{ --bg:#000; --fg:#fff; --accent:#00ff99; --muted:#bdbdbd; --border:#333; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--fg);
    font-family:"Press Start 2P",monospace;font-size:12px;line-height:1.45;
    display:flex;flex-direction:column;overflow-x:hidden;position:relative;
    cursor:none; /* custom cursor */
  }

  /* CRT scanlines + vignette */
  body::before{
    content:"";position:fixed;inset:0;z-index:1;pointer-events:none;
    background:
      radial-gradient(1200px 600px at 50% -10%, rgba(0,255,153,.20), rgba(0,0,0,0) 60%),
      repeating-linear-gradient(0deg, rgba(0,255,153,.09) 0px, rgba(0,255,153,.09) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 4px);
    mix-blend-mode:screen;animation:scanFlicker 6s linear infinite;
  }
  body::after{
    content:"";position:fixed;inset:0;z-index:1;pointer-events:none;
    box-shadow:inset 0 0 140px rgba(0,255,153,.22), inset 0 0 340px rgba(0,255,153,.15);
  }
  @keyframes scanFlicker{0%{opacity:.25}45%{opacity:.32}50%{opacity:.22}55%{opacity:.32}100%{opacity:.25}}

  .wrap{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center}
  .title{margin:28px 12px 10px;text-align:center;font-size:clamp(22px,5vw,46px);letter-spacing:2px;text-shadow:0 0 10px rgba(0,255,153,.22)}
  .logo-wrap{display:flex;justify-content:center;margin:10px 0 18px}
  .logo{width:min(520px,70vw);height:auto;image-rendering:pixelated;image-rendering:crisp-edges;filter:drop-shadow(0 0 16px rgba(0,0,0,.65))}
  .search-row{display:flex;align-items:center;gap:12px;margin:12px auto 22px;padding:0 16px}
  .label{font-size:14px}
  .field{display:flex;align-items:stretch;border:2px solid var(--fg);background:#000}
  input[type="search"]{width:min(640px,70vw);padding:12px 14px;border:0;outline:none;background:#000;color:#fff;font:inherit}
  button{width:44px;border:0;background:#000;color:#fff;cursor:pointer;border-left:2px solid var(--fg)}
  .mag::before{content:"\1F50D";display:block;line-height:42px;text-align:center}
  .menu{display:flex;gap:min(9vw,88px);flex-wrap:wrap;justify-content:center;margin:8px 0 16px;padding:0 16px}
  .menu a{color:#fff;text-decoration:underline;text-decoration-thickness:3px;text-underline-offset:8px;letter-spacing:1px;font-size:16px}
  .menu a:hover{text-decoration-color:var(--accent);text-shadow:0 0 8px rgba(255,255,255,.35)}
  #results{width:92vw;max-width:960px;margin:0 auto 28px;display:grid;gap:12px;z-index:2}
  .card{border:1px solid var(--border);background:#000;padding:14px}
  .src{color:var(--accent);font-size:10px;margin-bottom:6px}
  .titlelink{color:var(--accent);text-decoration:underline}
  .snippet{color:var(--accent);margin-top:4px}
  mark{background:transparent;color:var(--accent);text-decoration:underline;text-underline-offset:2px;text-decoration-thickness:2px}
  footer{margin-top:auto;padding:16px 10px;text-align:center;color:var(--muted);border-top:1px solid #233;z-index:2;font-size:10px}

  /* Slime overlay */
  #gooWrap{position:fixed;inset:0;z-index:9999;display:none}
  #goo,#gooHud{position:absolute;inset:0;width:100%;height:100%;display:block}
  #gooHud{pointer-events:none}
  #gooClose{position:absolute;top:10px;right:12px;z-index:10000;width:28px;height:28px;line-height:24px;border-radius:50%;border:1px solid #333;background:rgba(0,0,0,.35);color:#fff;cursor:pointer;display:none}

  /* Retro pixel-arrow cursor with glow */
  .crt-cursor{
    position:fixed;left:0;top:0;width:26px;height:36px;pointer-events:none;z-index:10002;
    background:#fff;
    clip-path:polygon(0% 0%,0% 100%,30% 70%,40% 80%,40% 100%,55% 100%,55% 82%,70% 82%,70% 64%,55% 64%,55% 40%,80% 40%,80% 22%,55% 22%,55% 0%);
    image-rendering:pixelated;
    filter:
      drop-shadow(1px 0 0 #000) drop-shadow(-1px 0 0 #000)
      drop-shadow(0 1px 0 #000) drop-shadow(0 -1px 0 #000)
      drop-shadow(0 0 7px rgba(255,255,255,.85))
      drop-shadow(0 0 22px rgba(255,255,255,.55))
      drop-shadow(0 0 60px rgba(255,255,255,.35));
    transform:translate(-2px,-2px);transition:transform .08s ease-out;
  }
  .crt-cursor.click{transform:translate(-2px,-2px) scale(.92)}
  @media (max-width:560px){.label{display:none}.menu{gap:28px}.menu a{font-size:14px;text-underline-offset:6px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">The Occult Reference Net</div>
    <div class="logo-wrap"><img src="GB-Logo_TORN.png" alt="Ghostbusters pixel logo" class="logo"></div>

    <div class="search-row">
      <div class="label">Search:</div>
      <div class="field">
        <input id="q" type="search" placeholder="Are you the Keymaster?">
        <button id="go" aria-label="Search"><span class="mag" aria-hidden="true"></span></button>
      </div>
    </div>

    <nav class="menu" aria-label="Main menu">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="sponsors.html">Sponsors</a>
      <a href="forum.html">Forum</a>
    </nav>

    <div id="results"></div>
    <footer>Helping paranormal investigators everywhere find the things that go bump in the night since © 1989.</footer>
  </div>

  <!-- Slime overlay -->
  <div id="gooWrap" aria-hidden="true">
    <canvas id="goo"></canvas>
    <canvas id="gooHud"></canvas>
    <button id="gooClose" aria-label="Dismiss slime">×</button>
  </div>

  <!-- Retro pixel-arrow cursor -->
  <script>
    (function(){
      const cursor=document.createElement('div');
      cursor.className='crt-cursor';
      document.body.appendChild(cursor);
      const hotspotX=2, hotspotY=2;
      let x=innerWidth/2,y=innerHeight/2,tx=x,ty=y; const speed=.35;
      function move(e){tx=e.clientX-hotspotX;ty=e.clientY-hotspotY;}
      function loop(){x+=(tx-x)*speed;y+=(ty-y)*speed;cursor.style.left=x+'px';cursor.style.top=y+'px';requestAnimationFrame(loop);}
      addEventListener('mousemove',move,{passive:true});
      addEventListener('mousedown',()=>cursor.classList.add('click'));
      addEventListener('mouseup',()=>cursor.classList.remove('click'));
      loop();
      // I-beam over inputs
      document.querySelectorAll('input,textarea').forEach(el=>{
        el.addEventListener('mouseenter',()=>{document.body.style.cursor='text';});
        el.addEventListener('mouseleave',()=>{document.body.style.cursor='none';});
      });
    })();
  </script>

  <!-- Minimal local search (reads index.json if present) -->
  <script>
    function escapeRegExp(s){return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
    function highlight(t,q){if(!t||!q)return t||"";const terms=[...new Set(q.trim().split(/\s+/).filter(Boolean))];if(!terms.length)return t;const re=new RegExp("("+terms.map(escapeRegExp).join("|")+")","ig");return t.replace(re,"<mark>$1</mark>");}
    let data=[];
    async function loadIndex(){try{const r=await fetch("index.json",{cache:"no-store"});data=await r.json();}catch{data=[];}}
    function localSearch(q){const ql=q.toLowerCase();return data.filter(d=>(d.title||"").toLowerCase().includes(ql)||(d.snippet||"").toLowerCase().includes(ql)||(d.author||"").toLowerCase().includes(ql)||(d.collection||"").toLowerCase().includes(ql)).slice(0,50);}
    async function runSearch(){const q=document.getElementById('q').value.trim();const box=document.getElementById('results');if(!data.length)await loadIndex();if(!q){box.innerHTML="";return;}const hits=localSearch(q);box.innerHTML=hits.length?"":"<div class='card'>No results. Try broader terms.</div>";for(const h of hits){const el=document.createElement('div');el.className="card";el.innerHTML=`<div class="src">${h.collection||h.source||""} ${h.type?`· ${h.type}`:""}</div><a class="titlelink" href="${h.url}" target="_blank" rel="noopener">${highlight(h.title||h.url,q)}</a><div class="snippet">${highlight(h.snippet||"",q)}</div><div class="src">${h.author?`author: ${h.author} · `:""}${h.year?`year: ${h.year}`:""}</div>`;box.appendChild(el);}}
    const qEl=document.getElementById('q');const def="Are you the Keymaster?";qEl.value=def;qEl.addEventListener('focus',()=>{if(qEl.value===def)qEl.value="";});qEl.addEventListener('blur',()=>{if(qEl.value.trim()==="")qEl.value=def;});document.getElementById('go').addEventListener('click',runSearch);qEl.addEventListener('keydown',e=>{if(e.key==="Enter")runSearch();});
  </script>

  <!-- Three.js (classic, non-module) -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <!-- MarchingCubes (classic, attaches to THREE.MarchingCubes) -->
  <script src="https://unpkg.com/three@0.160.0/examples/js/objects/MarchingCubes.js"></script>

  <!-- Slime animation using global THREE (no ES modules anywhere) -->
  <script>
    (function(){
      const IDLE_MS = 45000; // 45s idle
      const wrap = document.getElementById('gooWrap');
      const goo = document.getElementById('goo');
      const hud = document.getElementById('gooHud');
      const closeBtn = document.getElementById('gooClose');

      let hudCtx, W=0, H=0, dpr=1;
      let renderer, scene, camera, cubes, material;
      let running=false, raf, idleTimer, tLast=0, tSpawn=0;
      let balls=[];

      const SIM = { resolution:70, maxBalls:32, gravity:18, viscosity:0.985, spawnEvery:0.22, spawnJitterX:0.28, radiusBase:0.7, radiusVar:0.6, surface:2.5 };

      function fit(){
        dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1));
        W=wrap.clientWidth=innerWidth; H=wrap.clientHeight=innerHeight;
        renderer.setPixelRatio(dpr); renderer.setSize(W,H,false);
        hud.width=Math.round(W*dpr); hud.height=Math.round(H*dpr); hud.style.width=W+'px'; hud.style.height=H+'px';
        hudCtx.setTransform(dpr,0,0,dpr,0,0);
        camera.left=-W/2; camera.right=W/2; camera.top=H/2; camera.bottom=-H/2; camera.updateProjectionMatrix();
        cubes.position.set(-W/2,-H/2,0); cubes.scale.set(W,H,Math.max(W,H));
      }

      function init(){
        try{
          renderer=new THREE.WebGLRenderer({canvas:goo,antialias:true,alpha:true,powerPreference:'high-performance'});
          renderer.outputColorSpace=THREE.SRGBColorSpace;
          renderer.toneMapping=THREE.ACESFilmicToneMapping;
          renderer.toneMappingExposure=1.0;
        }catch(e){ console.error('WebGL init failed:', e); return; }

        scene=new THREE.Scene();
        camera=new THREE.OrthographicCamera(-1,1,1,-1,-1000,1000);
        camera.position.set(0,0,10);

        // Simple lighting (no module env required)
        const amb = new THREE.AmbientLight(0xffffff, 0.9);
        const dir = new THREE.DirectionalLight(0xffffff, 0.7);
        dir.position.set(0.5, 1, 1);
        scene.add(amb, dir);

        material=new THREE.MeshPhysicalMaterial({
          color: new THREE.Color(1.0, 0.7, 0.82),
          metalness:0.0, roughness:0.15,
          transmission:1.0, thickness:2.6, ior:1.38,
          clearcoat:0.5, clearcoatRoughness:0.18
        });

        cubes=new THREE.MarchingCubes(SIM.resolution, material, true, true, SIM.surface);
        scene.add(cubes);

        hudCtx=hud.getContext('2d');

        fit();
        addEventListener('resize',()=>{ if(running) fit(); });
      }

      function spawn(dt){
        tSpawn+=dt;
        if(tSpawn<SIM.spawnEvery || balls.length>=SIM.maxBalls) return;
        tSpawn=0;
        const rx=(Math.random()*2-1)*SIM.spawnJitterX*W/2;
        balls.push({x:W/2+rx,y:-40,z:(Math.random()*2-1)*0.25,r:SIM.radiusBase+Math.random()*SIM.radiusVar,vy:0});
      }

      function step(dt){
        for(const b of balls){ b.vy+=SIM.gravity*dt; b.vy*=SIM.viscosity; b.y+=b.vy; }
        balls=balls.filter(b=>b.y<H+100);
        cubes.reset();
        for(const b of balls){ cubes.addBall(b.x/W,b.y/H,0.5+b.z*0.1,b.r,1); }
        for(let i=0;i<12;i++){ cubes.addBall(i/11,-0.03,0.5,0.42,0.8); } // top lip
      }

      function drawHud(){
        const ctx=hudCtx;
        ctx.clearRect(0,0,W,H);
        ctx.globalCompositeOperation='lighter'; ctx.globalAlpha=.24;
        const g1=ctx.createRadialGradient(W*.22,90,10,W*.22,90,180);
        g1.addColorStop(0,'rgba(255,240,245,.9)'); g1.addColorStop(1,'rgba(255,240,245,0)');
        ctx.fillStyle=g1; ctx.beginPath(); ctx.arc(W*.22,90,160,0,Math.PI*2); ctx.fill();
        const g2=ctx.createRadialGradient(W*.78,110,10,W*.78,110,220);
        g2.addColorStop(0,'rgba(255,232,240,.9)'); g2.addColorStop(1,'rgba(255,232,240,0)');
        ctx.fillStyle=g2; ctx.beginPath(); ctx.arc(W*.78,110,190,0,Math.PI*2); ctx.fill();
        ctx.globalAlpha=1; ctx.globalCompositeOperation='source-over';
        const y=Math.min(H,balls.reduce((m,b)=>Math.max(m,b.y),0)+30);
        const gl=ctx.createLinearGradient(0,y,0,y+80);
        gl.addColorStop(0,'rgba(0,0,0,0)'); gl.addColorStop(1,'rgba(0,0,0,.35)');
        ctx.fillStyle=gl; ctx.fillRect(0,y,W,80);
      }

      function loop(ts){
        if(!running) return;
        if(!tLast) tLast=ts;
        const dt=Math.min(.033,(ts-tLast)/1000); tLast=ts;
        spawn(dt); step(dt);
        renderer.render(scene,camera); drawHud();
        raf=requestAnimationFrame(loop);
      }

      function show(){
        if(running) return;
        if(!renderer){ init(); }
        wrap.style.display='block';
        closeBtn.style.display='block';
        running=true; tLast=0; balls.length=0;
        raf=requestAnimationFrame(loop);
        wrap.setAttribute('aria-hidden','false');
      }
      function hide(){
        running=false; cancelAnimationFrame(raf);
        closeBtn.style.display='none'; wrap.style.display='none';
        wrap.setAttribute('aria-hidden','true');
      }
      function arm(){
        clearTimeout(idleTimer);
        if(running) hide();
        idleTimer=setTimeout(show,IDLE_MS);
      }

      closeBtn.addEventListener('click',e=>{e.stopPropagation();hide();arm();});
      wrap.addEventListener('click',()=>{hide();arm();});
      addEventListener('keydown',e=>{ if(e.key==='Escape'){hide();arm();} if(e.key.toLowerCase()==='s'){show();}});
      ['mousemove','keydown','scroll','touchstart','click'].forEach(ev=>addEventListener(ev,arm,{passive:true}));

      // Debug: instantly show with ?slime=1
      if(new URLSearchParams(location.search).get('slime')==='1'){ setTimeout(show,300); }
      addEventListener('DOMContentLoaded',arm);
    })();
  </script>
</body>
</html>
