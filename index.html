<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>The Occult Reference Net</title>

<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' fill='black'/%3E%3Ccircle cx='32' cy='36' r='16' fill='%23ff69b4'/%3E%3C/svg%3E">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<!-- FlexSearch -->
<script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>

<style>
  :root{ --bg:#000; --fg:#fff; --accent:#00ff99; --border:#333; }
  body{
    margin:0;background:var(--bg);color:var(--fg);
    font-family:"Press Start 2P",monospace;font-size:12px;
  }
  .title{text-align:center;margin:20px;font-size:20px}
  .logo-wrap{text-align:center;margin:20px}
  .logo{width:300px}
  .search-wrap{text-align:center;margin:20px}
  input{padding:10px;background:#000;color:#888;border:2px solid var(--fg);width:300px}
  button{padding:10px;background:#000;color:#fff;border:2px solid var(--fg);cursor:pointer}
  .btnbar{text-align:center;margin:20px}
  .btn{color:#fff;margin:0 10px;text-decoration:underline}
  .results{max-width:800px;margin:0 auto}
  .card{border:1px solid var(--border);padding:10px;margin:10px 0}
  footer{text-align:center;margin:20px;font-size:10px;color:#888}
  mark{background:transparent;color:var(--accent);text-decoration:underline}
</style>
</head>
<body>

<div class="title">The Occult Reference Net</div>
<div class="logo-wrap"><img src="GB-Logo_TORN.png" alt="Logo" class="logo"></div>

<div class="search-wrap">
  <input id="q" type="search" placeholder="Are you the Keymaster?">
  <button id="go">Search</button>
</div>

<nav class="btnbar">
  <a class="btn" href="index.html">Home</a>
  <a class="btn" href="about.html">About</a>
  <a class="btn" href="contact.html">Contact</a>
  <a class="btn" href="sponsors.html">Sponsors</a>
  <a class="btn" href="forum.html">Forum</a>
</nav>

<div id="results" class="results"></div>

<footer>Helping paranormal investigators everywhere find the things that go bump in the night since Â© 1989.</footer>

<!-- Search logic -->
<script>
  let data=[], index, byUrl=new Map();

  function escapeRegExp(s) {
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  function highlight(text,query){
    if(!text||!query) return text||"";
    const terms=[...new Set(query.trim().split(/\s+/).filter(Boolean))];
    if(!terms.length) return text;
    const re=new RegExp("(" + terms.map(escapeRegExp).join("|") + ")", "ig");
    return text.replace(re,"<mark>$1</mark>");
  }

  async function load(){
    const r=await fetch("index.json",{cache:"no-store"});
    data=await r.json();
    byUrl.clear(); for(const d of data){ if(d&&d.url) byUrl.set(d.url,d); }
    index=new FlexSearch.Document({
      document:{id:"url",index:["title","snippet","author","tags"]},
      tokenize:"forward"
    });
    for(const d of data){ index.add(d); }
  }

  function fallbackSearch(q){
    const ql=q.toLowerCase();
    return data.filter(d=>
      (d.title||"").toLowerCase().includes(ql)||
      (d.snippet||"").toLowerCase().includes(ql)||
      (d.author||"").toLowerCase().includes(ql)||
      (d.collection||"").toLowerCase().includes(ql)
    ).map(d=>d.url);
  }

  async function run(){
    const q=document.getElementById('q').value.trim();
    const box=document.getElementById('results');
    if(!index) await load();
    if(!q){ box.innerHTML=""; return; }
    let res=index.search(q,{enrich:true});
    let ids=[...new Set(res.flatMap(r=>r.result))];
    if(ids.length===0){ ids=fallbackSearch(q); }
    const hits=ids.map(u=>byUrl.get(u)).filter(Boolean).slice(0,50);
    box.innerHTML=hits.length?"":"<div class='card'>No results.</div>";
    for(const h of hits){
      const el=document.createElement('div'); el.className="card";
      el.innerHTML=`<a href="${h.url}" target="_blank">${highlight(h.title,q)}</a><div>${highlight(h.snippet,q)}</div>`;
      box.appendChild(el);
    }
  }

  document.getElementById('go').onclick=run;
  document.getElementById('q').addEventListener('keydown',e=>{if(e.key==="Enter")run();});
</script>

<!-- Slime effect -->
<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
  import { MarchingCubes } from 'https://unpkg.com/three@0.160.0/examples/jsm/objects/MarchingCubes.js';
  import { RoomEnvironment } from 'https://unpkg.com/three@0.160.0/examples/jsm/environments/RoomEnvironment.js';
  
  console.log("Three.js slime effect ready."); 
  // Minimal placeholder: load your slime code here with the same CDN imports
</script>

</body>
</html>
