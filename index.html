<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>The Occult Reference Net</title>

<!-- Font + shared cursor CSS -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>
  :root{ --bg:#000; --fg:#fff; --muted:#bbb; --accent:#00ff99; --border:#333; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:"Press Start 2P",monospace; font-size:12px; line-height:1.45;
    display:flex; flex-direction:column; position:relative; overflow-x:hidden;
  }

  /* CRT overlay */
  body::before, body::after{content:"";position:fixed;inset:0;pointer-events:none;z-index:9997}
  body::before{
    background:
      linear-gradient(rgba(0,255,153,0.06), rgba(0,255,153,0.06)) 0 0/100% 100%,
      repeating-linear-gradient(0deg, rgba(0,255,153,0.08) 0, rgba(0,255,153,0.08) 1px, transparent 2px, transparent 4px);
    mix-blend-mode:screen; animation:scan-flicker 6s infinite linear;
  }
  body::after{box-shadow:inset 0 0 120px rgba(0,255,153,0.12), inset 0 0 280px rgba(0,255,153,0.08)}
  @keyframes scan-flicker{0%{opacity:.22}45%{opacity:.28}50%{opacity:.20}55%{opacity:.28}100%{opacity:.22}}

  a{color:var(--accent); text-decoration:none}
  a:hover{text-decoration:underline}

  .title{margin:28px 12px 10px;text-align:center;font-size:clamp(22px,5vw,46px);letter-spacing:2px;text-shadow:0 0 8px rgba(0,255,153,.2)}

  .logo-wrap{display:flex;justify-content:center;margin:10px 0 18px}
  .logo{width:min(520px,80vw);height:auto;image-rendering:pixelated;image-rendering:crisp-edges;filter:drop-shadow(0 0 18px rgba(0,0,0,.6))}

  /* Search */
  .search-wrap{display:flex;justify-content:center;align-items:center;gap:12px;margin:6px auto 18px;padding:0 16px;width:100%}
  .label{font-size:14px;color:var(--fg)}
  .field{display:flex;align-items:stretch;gap:0;border:2px solid var(--fg);background:#000}
  input[type="search"]{
    width:min(560px,70vw);padding:12px 14px;border:0;outline:none;
    background:#000;color:#fff;font-family:inherit;font-size:12px;
  }
  button{background:#000;color:#fff;border:0;width:42px;padding:0;cursor:pointer;border-left:2px solid var(--fg)}
  button:active{transform:translateY(1px)}
  .mag{display:inline-block;width:100%;height:100%;font-size:16px}
  .mag::before{content:"\1F50D";display:block;line-height:42px;text-align:center}

  /* Bottom nav */
  .btnbar{display:flex;justify-content:center;gap:min(8vw,80px);margin:14px auto 20px;padding:0 16px;flex-wrap:wrap}
  .btn{color:#fff;text-decoration:underline;text-decoration-thickness:3px;text-underline-offset:8px;letter-spacing:1px;font-size:16px}
  .btn:hover{color:#fff;text-decoration-color:var(--accent);text-shadow:0 0 8px rgba(255,255,255,.35)}

  .results{max-width:960px;width:92vw;margin:0 auto 32px;display:grid;gap:12px}
  .card{border:1px solid var(--border);padding:14px;background:#000}
  .src{color:var(--accent);font-size:10px;margin-bottom:6px}
  .titlelink{color:var(--accent);text-decoration:underline}
  .snippet{color:var(--accent);margin-top:4px}

  footer{margin-top:auto;padding:18px 10px;text-align:center;color:var(--muted);border-top:1px solid var(--border)}
  .small{font-size:10px}

  /* highlight */
  mark{
    background:transparent;color:var(--accent);padding:0;
    text-decoration:underline;text-underline-offset:2px;text-decoration-thickness:2px;
  }

  /* ===== Idle Slime Overlay — DRIPPY VERSION ===== */
  .slime-wrap{
    position:fixed; inset:0; pointer-events:none; opacity:0; transition:opacity .6s ease;
    z-index:9998; /* below custom cursor (which should be >9998) */
  }
  body.slimed .slime-wrap{ opacity:1; pointer-events:auto; }

  .slime{
    position:absolute; left:0; right:0; top:-110%; height:130%;

    /* milky/translucent pink layers */
    background:
      radial-gradient(120px 40px at 15% 98%, rgba(255,182,193,.90) 30%, rgba(255,182,193,0) 70%),
      radial-gradient(180px 60px at 55% 99%, rgba(255,192,203,.85) 30%, rgba(255,192,203,0) 70%),
      radial-gradient(140px 50px at 85% 98%, rgba(255,160,190,.85) 30%, rgba(255,160,190,0) 70%),
      linear-gradient(to bottom, rgba(255,205,220,.88), rgba(255,170,195,.78) 35%, rgba(255,120,170,.62) 85%);
    backdrop-filter: blur(2px);
    box-shadow: 0 6px 18px rgba(255,105,180,.25);

    /* Drip edge mask */
    -webkit-mask-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 600' preserveAspectRatio='none'>\
  <defs>\
    <linearGradient id='g' x1='0' y1='0' x2='0' y2='1'>\
      <stop offset='0%' stop-color='white'/>\
      <stop offset='70%' stop-color='white'/>\
      <stop offset='100%' stop-color='black'/>\
    </linearGradient>\
  </defs>\
  <rect x='0' y='0' width='1200' height='600' fill='url(#g)'/>\
  <g fill='black'>\
    <path d='M100 560 q20 20 40 0 t40 0 t40 0 q20 -60 0 -120 q-18 -48 -10 -100 q40 40 70 120 q16 40 60 80 q12 10 30 -5 q-20 -120 40 -200 q40 40 44 104 q2 28 -2 76 q30 8 56 -16 q-8 -60 8 -120 q14 -52 44 -88 q46 46 58 90 q10 36 10 80 q30 6 52 -14 q-8 -64 10 -120 q18 -56 54 -94 q30 30 46 64 q18 38 18 78 q0 40 -10 86 q20 8 40 -10 q-6 -60 10 -110 q10 -32 30 -60 q38 38 52 78 q18 52 18 92 q0 36 -8 72 q52 10 96 -18 v42 H100 Z'/>\
  </g>\
</svg>");
    mask-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 600' preserveAspectRatio='none'>\
  <defs>\
    <linearGradient id='g' x1='0' y1='0' x2='0' y2='1'>\
      <stop offset='0%' stop-color='white'/>\
      <stop offset='70%' stop-color='white'/>\
      <stop offset='100%' stop-color='black'/>\
    </linearGradient>\
  </defs>\
  <rect x='0' y='0' width='1200' height='600' fill='url(#g)'/>\
  <g fill='black'>\
    <path d='M100 560 q20 20 40 0 t40 0 t40 0 q20 -60 0 -120 q-18 -48 -10 -100 q40 40 70 120 q16 40 60 80 q12 10 30 -5 q-20 -120 40 -200 q40 40 44 104 q2 28 -2 76 q30 8 56 -16 q-8 -60 8 -120 q14 -52 44 -88 q46 46 58 90 q10 36 10 80 q30 6 52 -14 q-8 -64 10 -120 q18 -56 54 -94 q30 30 46 64 q18 38 18 78 q0 40 -10 86 q20 8 40 -10 q-6 -60 10 -110 q10 -32 30 -60 q38 38 52 78 q18 52 18 92 q0 36 -8 72 q52 10 96 -18 v42 H100 Z'/>\
  </g>\
</svg>");
    -webkit-mask-size: 100% 100%; mask-size: 100% 100%;
    -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat;
    -webkit-mask-position: top center; mask-position: top center;

    /* Animations */
    animation:
      slime-ooze 18s ease-in forwards,
      slime-wobble 6s ease-in-out infinite,
      slime-shimmer 6s ease-in-out infinite;
  }

  .slime-dismiss{
    position:absolute; top:10px; right:12px;
    background:rgba(0,0,0,.25); color:#fff; border:1px solid #333;
    width:28px; height:28px; line-height:24px; border-radius:50%;
    font-family:inherit; font-size:16px; cursor:pointer;
    text-align:center; filter: drop-shadow(0 0 6px rgba(255,192,203,.7));
  }
  .slime-dismiss:hover{ background:rgba(0,0,0,.4); }

  @keyframes slime-ooze{
    0%   { transform: translateY(0); }
    65%  { transform: translateY(110%); }
    80%  { transform: translateY(104%); }
    100% { transform: translateY(108%); }
  }
  @keyframes slime-wobble{
    0%   { transform: translateY(108%) translateX(0px); }
    50%  { transform: translateY(108%) translateX(6px); }
    100% { transform: translateY(108%) translateX(0px); }
  }
  @keyframes slime-shimmer{
    0%   { filter: drop-shadow(0 0 10px rgba(255,192,203,.35)); }
    50%  { filter: drop-shadow(0 0 18px rgba(255,160,190,.45)); }
    100% { filter: drop-shadow(0 0 10px rgba(255,192,203,.35)); }
  }
  @media (prefers-reduced-motion: reduce){
    .slime{ animation: none; top:0; }
    .slime-wrap{ transition: none; }
  }

  @media (max-width:520px){
    .title{font-size:22px}
    .label{display:none}
    .btn{font-size:14px;text-underline-offset:6px}
    .btnbar{gap:24px}
  }
</style>
</head>
<body>

  <div class="title">The Occult Reference Net</div>

  <div class="logo-wrap">
    <img src="GB-Logo_TORN.png" alt="Ghostbusters pixel logo" class="logo">
  </div>

  <div class="search-wrap">
    <div class="label">Search:</div>
    <div class="field">
      <input id="q" type="search" placeholder="TYPE SEARCH TERMS…">
      <button id="go" aria-label="Search"><span class="mag" aria-hidden="true"></span></button>
    </div>
  </div>

  <nav class="btnbar" aria-label="Quick links">
    <a class="btn" href="index.html">Home</a>
    <a class="btn" href="about.html">About</a>
    <a class="btn" href="contact.html">Contact</a>
    <a class="btn" href="sponsors.html">Sponsors</a>
    <a class="btn" href="forum.html">Forum</a>
  </nav>

  <div id="results" class="results"></div>

  <footer>
    <div class="small">Helping paranormal investigators everywhere find the things that go bump in the night since © 1989.</div>
  </footer>

  <!-- Slime overlay (hidden until idle) -->
  <div class="slime-wrap" id="slimeWrap" aria-hidden="true">
    <div class="slime" id="slime"></div>
    <button class="slime-dismiss" id="slimeDismiss" aria-label="Dismiss slime">×</button>
  </div>

  <!-- Search -->
  <script src="https://unpkg.com/flexsearch/dist/flexsearch.bundle.js"></script>
  <script>
    let data = [], index, byUrl = new Map();

    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); }
    function highlight(text, query){
      if(!text || !query) return text || "";
      const terms = [...new Set(query.trim().split(/\\s+/).filter(Boolean))];
      if(!terms.length) return text;
      const re = new RegExp("(" + terms.map(escapeRegExp).join("|") + ")", "ig");
      return text.replace(re, "<mark>$1</mark>");
    }

    async function load(){
      const r = await fetch("index.json",{cache:"no-store"});
      data = await r.json();
      byUrl.clear();
      for(const d of data){ if(d && d.url) byUrl.set(d.url, d); }
      index = new FlexSearch.Document({
        document: { id: "url", index: ["title","snippet","author","tags"] },
        tokenize: "forward"
      });
      for(const d of data){ try{ index.add(d); }catch(_){} }
    }

    function fallbackSearch(q){
      const qlc = q.toLowerCase();
      return data.filter(d =>
        (d.title||"").toLowerCase().includes(qlc) ||
        (d.snippet||"").toLowerCase().includes(qlc) ||
        (d.author||"").toLowerCase().includes(qlc) ||
        (d.collection||"").toLowerCase().includes(qlc)
      ).map(d => d.url);
    }

    async function run(query){
      const qInput = document.getElementById('q');
      const q = (query !== undefined ? query : qInput.value).trim();
      const box = document.getElementById('results');
      if(!index) await load();
      if(!q){ box.innerHTML = ""; return; }
      let results = index.search(q, { enrich:true });
      let ids = [...new Set(results.flatMap(r => r.result))];
      if(ids.length === 0){ ids = fallbackSearch(q); }
      const hits = ids.map(u => byUrl.get(u)).filter(Boolean).slice(0,50);
      box.innerHTML = hits.length ? "" : "<div class='card'>No results. Try broader terms.</div>";
      for(const h of hits){
        const el = document.createElement('div'); el.className = "card";
        const title = highlight(h.title || h.url, q);
        const snippet = highlight(h.snippet || "", q);
        el.innerHTML = `
          <div class="src">${h.collection||h.source||""} ${h.type?`· ${h.type}`:""}</div>
          <a class="titlelink" href="${h.url}" target="_blank" rel="noopener">${title}</a>
          <div class="snippet">${snippet}</div>
          <div class="src">${h.author?`author: ${h.author} · `:""}${h.year?`year: ${h.year}`:""}</div>`;
        box.appendChild(el);
      }
    }

    function debounce(fn, delay=250){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), delay); }; }
    const runDebounced = debounce(run, 250);

    document.getElementById('go').onclick = () => run();

    window.addEventListener('DOMContentLoaded', () => {
      const defaultQuery = "Are you the Keymaster?";
      const qInput = document.getElementById('q');
      qInput.style.color = "#888";
      qInput.value = defaultQuery;

      function setDefault(){ qInput.value = defaultQuery; qInput.style.color = "#888"; }
      function clearDefault(){ if(qInput.value === defaultQuery){ qInput.value = ""; qInput.style.color = "#fff"; } }

      qInput.addEventListener('focus', clearDefault);
      qInput.addEventListener('blur', () => { if(qInput.value.trim()==="") setDefault(); });
      qInput.addEventListener('input', () => {
        if(qInput.value === defaultQuery) return;
        qInput.style.color = "#fff";
        if(qInput.value.trim()===""){ document.getElementById('results').innerHTML=""; return; }
        runDebounced(qInput.value);
      });
      qInput.addEventListener('keydown', e => { if(e.key==="Enter"){ e.preventDefault(); run(); } });

      run(defaultQuery);
    });
  </script>

  <!-- Idle Slime Controller -->
  <script>
    (function(){
      const IDLE_MS = 45000; // 45s
      const wrap = document.getElementById('slimeWrap');
      const btn  = document.getElementById('slimeDismiss');
      let t, slimed = false;

      function showSlime(){ if(!slimed){ slimed=true; document.body.classList.add('slimed'); wrap.setAttribute('aria-hidden','false'); } }
      function hideSlime(){ slimed=false; document.body.classList.remove('slimed'); wrap.setAttribute('aria-hidden','true'); }
      function arm(){ clearTimeout(t); if(slimed) hideSlime(); t = setTimeout(showSlime, IDLE_MS); }

      ['mousemove','keydown','scroll','touchstart','click'].forEach(ev=>{
        window.addEventListener(ev, arm, {passive:true});
      });

      btn.addEventListener('click', (e)=>{ e.stopPropagation(); hideSlime(); arm(); });
      wrap.addEventListener('click', ()=>{ hideSlime(); arm(); });
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ hideSlime(); arm(); }});

      window.addEventListener('DOMContentLoaded', arm);
    })();
  </script>

  <!-- Optional: animated CRT cursor (if you're using cursor.js) -->
  <script src="cursor.js" defer></script>
</body>
</html>

